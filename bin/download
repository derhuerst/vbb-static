#!/usr/bin/env node

var downloadGtfsFile =	require('../util/download-gtfs-file');





console.log('Downloading GTFS files from github.com/derhuerst/vbb-gtfs:');

console.log('- stops.txt -> data/stops.nedb');
downloadGtfsFile('https://raw.githubusercontent.com/derhuerst/vbb-gtfs/master/stops.txt', 'stops.nedb', function (data) {
	return {
		_id:		parseInt(data.stop_id),
		name:		data.stop_name,
		latitude:	data.stop_lat,
		longitude:	data.stop_lon
	};
});

console.log('- routes.txt -> data/routes.nedb');
types = {  // @vbb: wtf?
	'100':	'regional',
	'102':	'regional',
	'109':	'suburban',
	'400':	'subway',
	'700':	'bus',
	'900':	'bus',
	'1000':	'ferry'
};
downloadGtfsFile('https://raw.githubusercontent.com/derhuerst/vbb-gtfs/master/routes.txt', 'routes.nedb', function (data) {
	if (!data.route_short_name) {
		console.log('skipping route "', data.route_long_name, '"');
		return null;
	}
	return {
		_id:	parseInt(data.route_id),
		name:	data.route_short_name,
		type:	types[data.route_type] || 'unknown'
	};
});
